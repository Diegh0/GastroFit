<nav class="menu">
  <a [routerLink]="['']" class="comida-card-link">
    <div class="logo">ğŸ¥— Planificador Saludable</div>
  </a>

  <!-- BotÃ³n hamburguesa visible solo en mÃ³vil -->
  <button class="menu-toggle" (click)="toggleMenu()">â˜°</button>

  <!-- MenÃº de navegaciÃ³n -->
  <div class="nav-links" [ngClass]="{ open: menuAbierto }">
    <!-- Enlaces siempre visibles -->
    <a routerLink="/" routerLinkActive="active" (click)="cerrarMenu()">Inicio</a>
    <a routerLink="/ia" routerLinkActive="active" (click)="cerrarMenu()">MenÃº Inteligente</a>

    <!-- Enlaces protegidos (solo si hay usuario) -->
    <ng-container *ngIf="user$ | async as user">
      <a routerLink="/comidas" routerLinkActive="active" (click)="cerrarMenu()">Comidas</a>
      <a routerLink="/planificacion" routerLinkActive="active" (click)="cerrarMenu()">PlanificaciÃ³n</a>
    </ng-container>

    <!-- Mostrar login solo si no hay usuario -->
    <ng-container *ngIf="!(user$ | async)">
      <a routerLink="/auth" routerLinkActive="active" (click)="cerrarMenu()">Iniciar sesiÃ³n</a>
    </ng-container>
  </div>

  <!-- MenÃº de usuario con avatar -->
  <ng-container *ngIf="user$ | async as user">
    <button mat-icon-button [matMenuTriggerFor]="userMenu" class="avatar-btn">
      <span class="avatar-circle">{{ user.email?.[0] | uppercase }}</span>
    </button>

    <mat-menu #userMenu="matMenu" class="user-menu" [overlapTrigger]="false">
      <div class="menu-content">
        <div class="avatar-wrapper">
          <div class="avatar-large">{{ user.email?.[0] | uppercase }}</div>
        </div>
        <p class="user-email">{{ user.email }}</p>

        <!-- BotÃ³n para instalar la app -->
        <button *ngIf="mostrarBotonInstalar" mat-raised-button color="accent" (click)="instalarApp()">
          ğŸ“² Instalar app
        </button>

        <button mat-raised-button color="primary" (click)="logout()">Cerrar sesiÃ³n</button>
      </div>
    </mat-menu>
  </ng-container>
</nav>

<main class="contenido">
  <router-outlet></router-outlet>
</main>
