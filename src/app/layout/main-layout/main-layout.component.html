<nav class="menu">
  <a [routerLink]="['/']" class="comida-card-link">
    <div class="logo">ü•ó Planificador Saludable</div>
  </a>

  <!-- Bot√≥n hamburguesa visible solo en m√≥vil -->
  <button class="menu-toggle" (click)="toggleMenu()">‚ò∞</button>

  <!-- Men√∫ de navegaci√≥n -->
  <div class="nav-links" [ngClass]="{ open: menuAbierto }">
    <!-- Enlaces siempre visibles -->
    <!-- <a routerLink="/" routerLinkActive="active" (click)="cerrarMenu()">Inicio</a> -->
    <a routerLink="/ia" routerLinkActive="active" (click)="cerrarMenu()">Men√∫ Inteligente</a>

    <!-- Enlaces protegidos (solo si hay usuario) -->
    <ng-container *ngIf="user$ | async as user">
      <a routerLink="/comidas" routerLinkActive="active" (click)="cerrarMenu()">Comidas</a>
      <a routerLink="/planificacion" routerLinkActive="active" (click)="cerrarMenu()">Planificaci√≥n</a>
    </ng-container>

    <!-- Mostrar login solo si no hay usuario -->
    <ng-container *ngIf="!(user$ | async)">
      <a routerLink="/auth" routerLinkActive="active" (click)="cerrarMenu()">Iniciar sesi√≥n</a>
    </ng-container>
  </div>

  <!-- Men√∫ de usuario con avatar -->
  <ng-container *ngIf="user$ | async as user">
    <button mat-icon-button [matMenuTriggerFor]="userMenu" class="avatar-btn">
      <span class="avatar-circle">{{ user.email?.[0] | uppercase }}</span>
    </button>

    <mat-menu #userMenu="matMenu" class="user-menu" [overlapTrigger]="false">
      <div class="menu-content">
        <div class="avatar-wrapper">
          <div class="avatar-large">{{ user.email?.[0] | uppercase }}</div>
        </div>
        <p class="user-email">{{ user.email }}</p>

        <!-- Bot√≥n para instalar la app -->
        <button *ngIf="mostrarBotonInstalar" mat-raised-button color="accent" (click)="instalarApp()">
          üì≤ Instalar app
        </button>

        <button mat-raised-button color="primary" (click)="logout()">Cerrar sesi√≥n</button>
        <button mat-menu-item [routerLink]="['/perfil']">
          <mat-icon>person</mat-icon>
          Perfil
        </button>
        
      </div>
    </mat-menu>
  </ng-container>
</nav>

<main class="contenido">
  <router-outlet></router-outlet>
</main>
