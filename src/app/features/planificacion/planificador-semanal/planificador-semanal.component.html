<button mat-icon-button (click)="volver()" aria-label="Volver">
  <mat-icon>arrow_back</mat-icon>
</button>
<div class="contenedor-planificador">
  <!-- LISTA LATERAL -->
  <aside
  joyrideStep="comidasDisponibles"
  title="Comidas disponibles"
  text="AquÃ­ puedes ver las comidas que has guardado. ArrÃ¡stralas al calendario para planificarlas."
  class="lista-comidas"
  cdkDropList
  id="lista-comidas"
  [cdkDropListData]="comidasDisponibles"
  [cdkDropListConnectedTo]="celdasIds"
>
    <h3>ğŸ½ï¸ Comidas disponibles</h3>
    <div
      *ngFor="let comida of comidasDisponibles"
      class="comida-item"
      cdkDrag
      [cdkDragData]="comida"
    >
      {{ comida.nombre }}
    </div>
  </aside>

  <!-- CALENDARIO -->
  <section class="calendario" cdkDropListGroup>
    <!-- Selector de semana -->
    <div class="selector-semana">
      <label for="fecha">ğŸ“… Semana:</label>
      <input
        id="fecha"
        type="date"
        [value]="fechaSemana"
        (change)="cambiarSemana($event)"
        class="boton-outlined"
      />
    </div>

    <!-- Tabla del calendario -->
    <table
      joyrideStep="tablaPlanificacion"
      title="Tabla semanal"
      text="Esta es tu semana: puedes soltar comidas por franjas y dÃ­as. TambiÃ©n puedes aÃ±adir mÃ¡s franjas."
      class="tabla-calendario"
    >
      <thead>
        <tr>
          <th></th>
          <th *ngFor="let dia of dias">
            {{ dia }}
            <button class="boton-icono" (click)="calcularResumenPorDia(dia)">
              ğŸ“‹
            </button>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let franja of franjas">
          <th>{{ franja }}</th>
          <td *ngFor="let dia of dias">
            <div
              class="celda-drop"
              [id]="'celda-' + dia + '-' + franja"
              cdkDropList
              [cdkDropListData]="planificacion[franja][dia]"
              [cdkDropListConnectedTo]="['lista-comidas']"
              (cdkDropListDropped)="onDrop($event, dia, franja)"
            >
              <div
                *ngFor="let comida of planificacion[franja][dia]; let i = index"
                class="comida-drop"
              >
                {{ comida.nombre }}
                <button class="btn-delete" (click)="eliminarComida(dia, franja, i)">
                  âŒ
                </button>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- ResÃºmenes diarios -->
    <div *ngFor="let dia of dias">
      <div class="resumen-dia" *ngIf="mostrarResumenDia[dia] && resumenPorDia[dia]">
        <h4>Resumen de {{ dia }}</h4>
        <ul>
          <li><strong>CalorÃ­as:</strong> {{ resumenPorDia[dia].calorias }} kcal</li>
          <li><strong>ProteÃ­nas:</strong> {{ resumenPorDia[dia].proteinas }} g</li>
          <li><strong>Grasas:</strong> {{ resumenPorDia[dia].grasas }} g</li>
          <li><strong>Hidratos:</strong> {{ resumenPorDia[dia].hidratos }} g</li>
        </ul>
      </div>
    </div>

    <!-- BOTONES -->
    <div
    joyrideStep="accionesPlanificador"
    title="Opciones de planificaciÃ³n"
    text="AquÃ­ puedes aÃ±adir franjas, ver resÃºmenes nutricionales y duplicar semanas pasadas."
    class="botonera"
  >
      <button class="boton-outlined" (click)="abrirModalFranja()">â• AÃ±adir franja horaria</button>
      <button class="boton-accent" (click)="verResumenSemanal()">ğŸ“Š Ver resumen semanal</button>
      <button class="boton-primario" (click)="mostrarDuplicador = !mostrarDuplicador">ğŸ“‹ Duplicar semana</button>
      <button class="boton-outlined" (click)="mostrarHistorial = !mostrarHistorial">ğŸ“… Ver historial de semanas</button>
     </div>
   
    

    <!-- Duplicador visible -->
    <div class="duplicador-semana" *ngIf="mostrarDuplicador">
      <label for="duplicarFecha">ğŸ“… Fecha destino:</label>
      <input type="date" id="duplicarFecha" [(ngModel)]="fechaDuplicar" />
      <button (click)="ejecutarDuplicado()">âœ… Duplicar</button>
    </div>

    <!-- Historial de semanas -->
  

    <div class="historial-semanas" *ngIf="mostrarHistorial">
      <h4>Semanas guardadas</h4>
      <ul>
        <li *ngFor="let semana of semanasGuardadas">
          ğŸ“† {{ semana }}
          <button (click)="cambiarSemanaDesdeHistorial(semana)">ğŸ“‚ Cargar</button>
          <button (click)="eliminarSemana(semana)">ğŸ—‘ï¸ Borrar</button>
        </li>
      </ul>
    </div>

    <!-- Resumen semanal -->
    <div
      *ngIf="mostrarResumenSemanal && resumenSemanal"
      joyrideStep="resumenSemanal"
      title="Resumen nutricional"
      text="Consulta aquÃ­ los totales de calorÃ­as, proteÃ­nas, grasas e hidratos de la semana."
      class="resumen-semanal"
    >
      <h3>Resumen Nutricional Semanal</h3>
      <ul>
        <li><strong>CalorÃ­as:</strong> {{ resumenSemanal.calorias }} kcal</li>
        <li><strong>ProteÃ­nas:</strong> {{ resumenSemanal.proteinas }} g</li>
        <li><strong>Grasas:</strong> {{ resumenSemanal.grasas }} g</li>
        <li><strong>Hidratos:</strong> {{ resumenSemanal.hidratos }} g</li>
      </ul>
    </div>
    <!-- Modal para aÃ±adir franja -->
<div *ngIf="mostrarModalFranja" class="modal-franja">
  <h3>Nombre de la nueva franja horaria</h3>
  <input [(ngModel)]="nombreNuevaFranja" placeholder="Ej. Almuerzo" />
  <button (click)="confirmarAgregarFranja()">AÃ±adir</button>
  <button (click)="mostrarModalFranja = false">Cancelar</button>
</div>

  </section>
<!-- Mensaje de confirmaciÃ³n -->
<div class="mensaje-confirmacion" *ngIf="mostrarMensaje">
  {{ mensajeConfirmacion }}
</div>
</div>
